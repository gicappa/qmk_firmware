#include QMK_KEYBOARD_H

// helpers
#define _______ KC_TRNS

// layers
#define BASE 0
#define FNKC 1
#define CODE 2
#define ONAN 3
#define ARRW 4
#define MEDI 5
#define NUMS 6
#define EMPT 7
#define X_CODE 8

// layer selectors
#define _L1_Q    LT(FNKC, KC_Q)
#define _L1_P    LT(FNKC, KC_P)
#define _L2_Z    LT(CODE, KC_Z)
#define _L2_SLA  LT(CODE, KC_SLASH)
#define _L8_BSPC LT(NUMS, KC_BSPC)
#define _L3_SPC  LT(CODE, KC_SPACE)
#define _L6_ENT  LT(ONAN, KC_ENT)
#define _L7_DEL  LT(NUMS, KC_DEL)
#define _L4_A    LT(ARRW, KC_A)
#define _L5_FN   TT(MEDI)
#define L_NUMS   MO(NUMS)

//tap-mod
#define _F MT(MOD_LSFT, KC_F)
#define _J MT(MOD_RSFT, KC_J)
#define _D MT(MOD_LALT, KC_D)
#define _K MT(MOD_RALT, KC_K)
#define _S MT(MOD_LCTL, KC_S)
#define _L MT(MOD_RCTL, KC_L)
#define _E MT(MOD_LGUI, KC_E)
#define _I MT(MOD_RGUI, KC_I)
#define _R MT(MOD_LALT, KC_R)
#define _U MT(MOD_RALT, KC_U)

//shortcut for common commands
#define _CMD_Q   LGUI(KC_Q)
#define _CMD_W   LGUI(KC_W)
#define _COPY    LGUI(KC_C)
#define _PASTE   LGUI(KC_V)
#define _UNDO    LGUI(KC_Z)
#define _CUT     LGUI(KC_X)
#define _ALL     LGUI(KC_A)
#define _SAVE    LGUI(KC_S)
#define _OPEN    LGUI(KC_O)
#define _FIND    LGUI(KC_F)

// CMD+TAB and CMD+SHIFT+TAB definitions
enum custom_keycodes {
    CMD_TAB = SAFE_RANGE,
    SCM_TAB,
    L_ONAN
};

bool cmd_tab_active = false;

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  switch (keycode) {
    case L_ONAN:
      if (record->event.pressed) {
        layer_on(ONAN);
      } else {
        layer_off(ONAN);
        if (cmd_tab_active) {
            cmd_tab_active = false;
            unregister_code(KC_LCMD);
        }
      }
      break;
    case CMD_TAB:
      if (record->event.pressed) {
        cmd_tab_active = true;
        register_code(KC_LCMD);
        register_code(KC_TAB);
      } else {
        unregister_code(KC_TAB);
      }
      break;
    case SCM_TAB:
      if (record->event.pressed) {
        cmd_tab_active = true;
        register_code(KC_LCMD);
        register_code(KC_LSFT);
        register_code(KC_TAB);
      } else {
        unregister_code(KC_LSFT);
        unregister_code(KC_TAB);
      }
      break;
      default:
        return true;
  }
  return true;
}

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
  /* Base (QWERTY) Layer [BASE] active by default
    ┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
    | `/ESC  |   1    |   2    |   3    |    4   |    5   |                          |    6   |   7    |   8    |   9    |   0    |   _/-  |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |  TAB   | Q^FNKC |   W    | E\cmd  | R\alt  |    T   |                          |    Y   | U\Ralt | I/Cmd  |   O    | P^FNKC |   +/=  |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |  CAPS  | A^CURS | S\ctl  | D\alt  | F\sft  |    G   |                          |    H   | J\Rsft | K\Ralt | L\Rctl |   :/;  |   "/'  |
    ├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
    |   ~    | Z^CODE |   X    |   C    |    V   |    B   | SPACE  |        | SPACE  |    N   |   M    |   </,  |  >/.   | /^CODE |   |-\  |
    └────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                   |        | ONAN   | SPACE  |                 | SPACE  |  NUMS  |        |
                                   └────────┴────────┴────────┘                 └────────┴────────┴────────┘
  */
  [BASE] = LAYOUT(
    QK_GESC,  KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                                KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    KC_MINS,
    KC_TAB,   _L1_Q,   KC_W,    _E,      _R,      KC_T,                                KC_Y,    _U,      _I,      KC_O,    _L1_P,   KC_EQL,
    KC_CAPS,  _L4_A,   _S,      _D,      _F,      KC_G,                                KC_H,    _J,      _K,      _L,      KC_SCLN, KC_QUOT,
    KC_TILD,  _L2_Z,   KC_X,    KC_C,    KC_V,    KC_B,    KC_SPACE,         KC_SPACE, KC_N,    KC_M,    KC_COMM, KC_DOT, _L2_SLA,  KC_BSLS,
                                         XXXXXXX, L_ONAN,  KC_SPACE,         KC_SPACE, L_NUMS,  XXXXXXX
  ),

  /* Functions Layer [FNKC] active by holding Q or P
    ┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
    |   F1   |   F2   |   F3   |   F4   |   F5   |   F6   |                          |   F7   |   F8   |   F9   |   F10  |   F11  |   F12  |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |                          |   F1   |   F2   |   F3   |   F4   |        |QK_BOOT |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |                          |   F5   |   F6   |   F7   |   F8   |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |        |        |        |   F9   |   F10  |   F11  |   F12  |        |        |
    └────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                   |        |        |        |                 |        |        |        |
                                   └────────┴────────┴────────┘                 └────────┴────────┴────────┘
  */
  [FNKC] = LAYOUT(
    KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,   KC_F6,                               KC_F7,   KC_F8,   KC_F9,   KC_F10,  KC_F11,  KC_F12,
    _______, _______, _______, _______, _______, _______,                             KC_F1,   KC_F2,   KC_F3,   KC_F4,   _______, QK_BOOT,
    _______, _______, _______, _______, _______, _______,                             KC_F5,   KC_F6,   KC_F7,   KC_F8,   _______, _______,
    _______, _______, _______, _______, _______, _______, _______,           _______, KC_F9,   KC_F10,  KC_F11,  KC_F12,  _______, _______,
                                        _______, _______, _______,           _______, _______, _______
  ),

  /* Numbers layer [NUMS] active by holding ENTER
    ┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
    |        |        |        |        |        |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |
    └────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                   |        |        |        |                 |        |        |        |
                                   └────────┴────────┴────────┘                 └────────┴────────┴────────┘
  */
  [NUMS] = LAYOUT(
    _______, _______, _______, _______, _______, _______,                             _______, _______, _______, _______, _______, _______,
    _______, KC_BSPC, KC_DEL,  _______, _______, _______,                             _______, _______, _______, KC_DEL,  KC_BSPC, _______,
    KC_ENT,  KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                                KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    KC_ENT,
    _______, _______, _______, _______, _______, _______, _______,           _______, _______, _______, _______, _______, _______, _______,
                                        _______, _______, _______,           _______, _______, _______
  ),

  /* Coding Layer [CODE] active by holding Z or /
    ┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
    |        |        |        |        |        |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |   &    |  ~     |   `    |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |
    └────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                   |        |        |        |                 |        |        |        |
                                   └────────┴────────┴────────┘                 └────────┴────────┴────────┘
  */
  [CODE] = LAYOUT(
    _______, _______, _______, _______, _______, _______,                            _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______, _______, _______,                            _______, _______, _______, _______, _______, _______,
    KC_EXLM, KC_AT,   KC_HASH, KC_DLR,  KC_PERC, KC_CIRC,                            KC_AMPR, KC_ASTR, KC_LPRN, KC_RPRN, KC_MINS, KC_PLUS,
    _______, _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
                                        _______, _______, _______,          _______, _______, _______
  ),

  /* One Hand Layer [ONAN] active by holding Z or /
    ┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
    |        |        |        |        |        |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |  QUIT  | CL WIN | C-TAB  | C-S-TAB|        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |  ALL   |  SAVE  |  OPEN  |  FIND  |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
    |        |  UNDO  |  CUT   |  COPY  | PASTE  |        |        |        |        |        |        |        |        |        |        |
    └────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                   |        |        |        |                 |        |        |        |
                                   └────────┴────────┴────────┘                 └────────┴────────┴────────┘
  */
  [ONAN] = LAYOUT(
    _______, _______, _______, _______, _______, _______,                             _______, _______, _______, _______, _______, _______,
    _______, _CMD_Q,  _CMD_W,  SCM_TAB, CMD_TAB, _______,                             _______, _______, _______, _______, _______, _______,
    _______, _ALL,    _SAVE,   _OPEN,   _FIND,   _______,                             _______, _______, _______, _______, _______, _______,
    _______, _UNDO,   _CUT,    _COPY,   _PASTE,  _______, _______,           _______, _______, _______, _______, _______, _______, _______,
                                        _______, _______, _______,           _______, _______, _______
  ),

  /* Arrows Layer [ARRW] active by holding A
    ┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
    |        |        |        |        |        |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |                          | PAG DN |   UP   | PAG UP | PR SCR | ScrLck | PAUSE  |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |                          |  LEFT  |  DOWN  | RIGHT  | RIGHT  |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |        |        |        |  HOME  |  INS   |  END   |        |        |        |
    └────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                   |        |        |        |                 |        |        |        |
                                   └────────┴────────┴────────┘                 └────────┴────────┴────────┘
  */
  [ARRW] = LAYOUT(
    _______, _______, _______, _______, _______, _______,                             _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______, _______, _______,                             _______, KC_PGDN, KC_UP,   KC_PGUP, KC_SCRL, KC_PAUS,
    _______, _______, _______, _______, _______, _______,                             _______, KC_LEFT, KC_DOWN, KC_RGHT, KC_PSCR, _______,
    _______, _______, _______, _______, _______, _______, _______,           _______, _______, KC_HOME, KC_INS,  KC_END,  _______, _______,
                                        _______, _______, _______,           _______, _______, _______
  ),

  /* Coding Layer [CODE] active by holding Z or /
    ┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
    |        |        |        |        |        |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |   &    |  ~     |   `    |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |
    └────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                   |        |        |        |                 |        |        |        |
                                   └────────┴────────┴────────┘                 └────────┴────────┴────────┘
  */
  [X_CODE] = LAYOUT(
    KC_EXLM, KC_AT,   KC_HASH, KC_DLR,  KC_PERC, KC_CIRC,                            KC_AMPR, KC_ASTR, KC_LPRN, KC_RPRN, KC_MINS, KC_PLUS,
    KC_EXLM, KC_LBRC, KC_PLUS, KC_RBRC, KC_GRV,  KC_TILD,                            KC_EXLM, KC_LBRC, KC_PLUS, KC_RBRC, KC_GRV,  KC_TILD,
    KC_DLR,  KC_LPRN, KC_EQL,  KC_RPRN, KC_PIPE, _______,                            KC_DLR,  KC_LPRN, KC_EQL,  KC_RPRN, KC_PIPE, _______,
    KC_CIRC, KC_LCBR, KC_MINS, KC_RCBR, KC_ASTR, _______, _______,          _______, KC_CIRC, KC_LCBR, KC_MINS, KC_RCBR, KC_ASTR, _______,
                                        _______, _______, _______,          _______, _______, _______
  ),

  /*
    ┌────────┬────────┬────────┬────────┬────────┬────────┐                          ┌────────┬────────┬────────┬────────┬────────┬────────┐
    |        |        |        |        |        |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┤                          ├────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |                          |        |        |        |        |        |        |
    ├────────┼────────┼────────┼────────┼────────┼────────┼────────┐        ┌────────┼────────┼────────┼────────┼────────┼────────┼────────┤
    |        |        |        |        |        |        |        |        |        |        |        |        |        |        |        |
    └────────┴────────┴────────┴───┬────┴───┬────┴───┬────┴───┬────┘        └───┬────┴───┬────┴───┬────┴───┬────┴────────┴────────┴────────┘
                                   |        |        |        |                 |        |        |        |
                                   └────────┴────────┴────────┘                 └────────┴────────┴────────┘
  */
  [EMPT] = LAYOUT(
    _______, _______, _______, _______, _______, _______,                             _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______, _______, _______,                             _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______, _______, _______,                             _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______, _______, _______, _______,           _______, _______, _______, _______, _______, _______, _______,
                                        _______, _______, _______,           _______, _______, _______
  )

};

